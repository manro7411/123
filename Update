2025-10-30 09:38:59,145 ERROR [io.qua.ver.htt.run.QuarkusErrorHandler] (executor-thread-22) HTTP Request to /trainer/content-performance?start=2025-10-24&end=2025-10-30&view=team&teamId=3fbf03f3013f42d2b9402&userEmail=Nattida+Kraisikaj+(member)&order=learners:desc&limit=50&offset=0 failed, error id: f79818b9-07d9-4e10-b582-ec6c83428c9a-26

Exception in TrainerAnalyticResources.java:318
          316  
          317          @SuppressWarnings("unchecked")                                                                                                                                                                               
        ? 318          List<Object[]> rows = q.getResultList();                                                                                                                                                                     
          319                                                                                                                                                                                                                       
          320          // ---------- Learner details (��ͧ����͹ main) ----------                                                                                                                                                     

Exception in TrainerAnalyticResources.java:318
          316                                                                                                                                                                                                                       
          317          @SuppressWarnings("unchecked")                                                                                                                                                                               
        ? 318          List<Object[]> rows = q.getResultList();                                                                                                                                                                     
          319                                                                                                                                                                                                                       
          320          // ---------- Learner details (��ͧ����͹ main) ----------: org.hibernate.exception.SQLGrammarException: JDBC exception executing SQL [    SELECT                                                              
      lc.id AS content_id,                                                                                                                                                                                                          
      lc.title AS title,                                                                                                                                                                                                            
      COUNT(DISTINCT p.user_email) AS learners,                                                                                                                                                                                     
      AVG(CASE WHEN p.percent = 100 THEN 1.0 ELSE 0.0 END) AS completion_rate,                                                                                                                                                      
      AVG(p.score) AS avg_score                                                                                                                                                                                                     
    FROM learning_content lc                                                                                                                                                                                                        
    LEFT JOIN user_lesson_progress p ON p.lesson_id = lc.id                                                                                                                                                                         
      AND (                                                                                                                                                                                                                         
           (p.started_at   IS NOT NULL AND p.started_at   >= ? AND p.started_at   < ?)                                                                                                                                              
        OR (p.completed_at IS NOT NULL AND p.completed_at >= ? AND p.completed_at < ?)                                                                                                                                              
      )                                                                                                                                                                                                                             
      AND LOWER(p.user_email) = ?                                                                                                                                                                                                   
    WHERE lc.team_id = ?                                                                                                                                                                                                            
    GROUP BY lc.id, lc.title                                                                                                                                                                                                        
    ORDER BY learners DESC fetch first ? rows only                                                                                                                                                                                  
] [ERROR: column lc.team_id does not exist                                                                                                                                                                                          
  Position: 555] [n/a]                                                                                                                                                                                                              
        at org.hibernate.exception.internal.SQLStateConversionDelegate.convert(SQLStateConversionDelegate.java:91)                                                                                                                  
        at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)                                                                                                            
        at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)                                                                                                                                    
        at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)                                                                                                                                     
        at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:269)                                                                                                           
        at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:172)                                                                                                           
        at org.hibernate.sql.results.jdbc.internal.AbstractResultSetAccess.getMetaData(AbstractResultSetAccess.java:36)                                                                                                             
        at org.hibernate.sql.results.jdbc.internal.AbstractResultSetAccess.getColumnCount(AbstractResultSetAccess.java:52)                                                                                                          
        at org.hibernate.query.results.ResultSetMappingImpl.resolve(ResultSetMappingImpl.java:194)                                                                                                                                  
        at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.resolveJdbcValuesSource(JdbcSelectExecutorStandardImpl.java:340)                                                                                          
        at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:137)                                                                                                   
        at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:102)                                                                                                     
        at org.hibernate.sql.exec.spi.JdbcSelectExecutor.executeQuery(JdbcSelectExecutor.java:91)                                                                                                                                   
        at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:165)                                                                                                                                          
        at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:142)                                                                                                                                          
        at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:132)                                                                                                                                          
        at org.hibernate.query.sql.internal.NativeSelectQueryPlanImpl.performList(NativeSelectQueryPlanImpl.java:135)                                                                                                               
        at org.hibernate.query.sql.internal.NativeQueryImpl.doList(NativeQueryImpl.java:697)                                                                                                                                        
        at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:143)                                                                                                                                     
        at org.hibernate.query.Query.getResultList(Query.java:120)                                                                                                                                                                  
        at TrainerAnalytic.Resources.TrainerAnalyticResources.contentPerformance(TrainerAnalyticResources.java:318)                                                                                                                 
        at TrainerAnalytic.Resources.TrainerAnalyticResources_Subclass.contentPerformance$$superforward(Unknown Source)                                                                                                             
        at TrainerAnalytic.Resources.TrainerAnalyticResources_Subclass$$function$$2.apply(Unknown Source)                                                                                                                           
        at io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:73)                                                                                                                         
        at io.quarkus.arc.impl.AroundInvokeInvocationContext$NextAroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:97)                                                                                       
        at io.quarkus.security.runtime.interceptor.SecurityHandler.handle(SecurityHandler.java:27)                                                                                                                                  
        at io.quarkus.security.runtime.interceptor.RolesAllowedInterceptor.intercept(RolesAllowedInterceptor.java:29)                                                                                                               
        at io.quarkus.security.runtime.interceptor.RolesAllowedInterceptor_Bean.intercept(Unknown Source)                                                                                                                           
        at io.quarkus.arc.impl.InterceptorInvocation.invoke(InterceptorInvocation.java:42)                                                                                                                                          
        at io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:70)                                                                                                                         
        at io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:62)                                                                                                                         
        at io.quarkus.resteasy.reactive.server.runtime.StandardSecurityCheckInterceptor.intercept(StandardSecurityCheckInterceptor.java:44)                                                                                         
        at io.quarkus.resteasy.reactive.server.runtime.StandardSecurityCheckInterceptor_RolesAllowedInterceptor_Bean.intercept(Unknown Source)                                                                                      
        at io.quarkus.arc.impl.InterceptorInvocation.invoke(InterceptorInvocation.java:42)                                                                                                                                          
        at io.quarkus.arc.impl.AroundInvokeInvocationContext.perform(AroundInvokeInvocationContext.java:30)                                                                                                                         
        at io.quarkus.arc.impl.InvocationContexts.performAroundInvoke(InvocationContexts.java:27)                                                                                                                                   
        at TrainerAnalytic.Resources.TrainerAnalyticResources_Subclass.contentPerformance(Unknown Source)                                                                                                                           
        at TrainerAnalytic.Resources.TrainerAnalyticResources$quarkusrestinvoker$contentPerformance_6e652322075c378f8dbe169c9f842f6afe4d9dcb.invoke(Unknown Source)                                                                 
        at org.jboss.resteasy.reactive.server.handlers.InvocationHandler.handle(InvocationHandler.java:29)                                                                                                                          
        at io.quarkus.resteasy.reactive.server.runtime.QuarkusResteasyReactiveRequestContext.invokeHandler(QuarkusResteasyReactiveRequestContext.java:141)                                                                          
        at org.jboss.resteasy.reactive.common.core.AbstractResteasyReactiveContext.run(AbstractResteasyReactiveContext.java:147)                                                                                                    
        at io.quarkus.vertx.core.runtime.VertxCoreRecorder$15.runWith(VertxCoreRecorder.java:637)                                                                                                                                   
        at org.jboss.threads.EnhancedQueueExecutor$Task.doRunWith(EnhancedQueueExecutor.java:2651)                                                                                                                                  
        at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2630)                                                                                                                                        
        at org.jboss.threads.EnhancedQueueExecutor.runThreadBody(EnhancedQueueExecutor.java:1622)                                                                                                                                   
        at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1589)                                                                                                                                  
        at org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:11)                                                                                                                                                     
        at org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:11)                                                                                                                                 
        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)                                                                                                                                    
        at java.base/java.lang.Thread.run(Thread.java:1583)                                                                                                                                                                         
Caused by: org.postgresql.util.PSQLException: ERROR: column lc.team_id does not exist                                                                                                                                               
  Position: 555                                                                                                                                                                                                                     
        at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2736)                                                                                                                               
        at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2423)                                                                                                                                     
        at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:374)                                                                                                                                             
        at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:518)                                                                                                                                                    
        at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435)                                                                                                                                                            
        at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196)                                                                                                                                   
        at org.postgresql.jdbc.PgPreparedStatement.executeQuery(PgPreparedStatement.java:139)                                                                                                                                       
        at io.agroal.pool.wrapper.PreparedStatementWrapper.executeQuery(PreparedStatementWrapper.java:80) 
