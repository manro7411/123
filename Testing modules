SELECT
    t.name AS team_name,
    lc.title AS course_name,
    COUNT(p.id) AS enrollment_count
FROM
    user_lesson_progress p
JOIN
    users u ON p.user_email = u.email
JOIN
    team_members m ON u.id = m.member_ID
JOIN
    teams t ON m.team_id = t.id
JOIN
    learning_content lc ON p.lesson_id = lc.id
WHERE
    p.completed_at IS NOT NULL
GROUP BY
    t.name, lc.title
ORDER BY
    enrollment_count DESC
LIMIT 10;
